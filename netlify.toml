# Settings in the [build] context are global and are applied to all contexts
# unless otherwise overridden by more specific contexts.
[build]
  # Directory to change to before starting a build.
  # This is where we will look for package.json/.nvmrc/etc.
  base = ""

  # Default build command.
  command = 'pelican -e SITEURL="\"${DEPLOY_PRIME_URL}\""'

  # Directory (relative to root of your repo) that contains the deploy-ready
  # HTML files and assets generated by the build. If a base directory has
  # been specified, include it in the publish directory path.
  publish = "output/"

[context.production]
  # Default build command.
  command = 'pelican --fatal warnings -e SITEURL="\"${URL}\"" && rm -rf output/drafts'

[[headers]]
  for = "/*"
  [headers.values]
    # Only allow resources to be loaded from the current origin. Styles may
    # also be specified inline, and allow the Google Analytics scripts.
    Content-Security-Policy = "default-src 'self'; style-src 'self'; script-src 'self'"

    # Disable all browser features that we don't need. Unfortunately
    # there is no way to specify a default for all directives yet, so
    # the list is very long.
    # See this for details:
    # https://github.com/w3c/webappsec-permissions-policy/issues/189
    Permissions-Policy = "ambient-light-sensor=(); autoplay=(); accelerometer=(); camera=(); display-capture=(); document-domain=(); encrypted-media=(); fullscreen=(); gyroscope=(); magnetometer=(); microphone=(); midi=(); payment=(); picture-in-picture=(); sync-xhr=(); usb=(); wake-lock=(); xr-spatial-tracking=()"

    # Don't send the Referrer header over insecure connections (when
    # linking to HTTP sites)
    Referrer-Policy = "no-referrer-when-downgrade"

    # Disable mime-type sniffing (probably not relevant without user
    # uploads,but doesn't hurt either)
    X-Content-Type-Options = "nosniff"

    # Prohibit framing to prevent clickjacking attacks
    X-Frame-Options = "DENY"

    # Stop page from loading if a reflected XSS attack is detected
    X-XSS-Protection = "1; mode=block"

[[headers]]
  for = "/news/*"
  [headers.values]
    # Additionally allow YouTube/Discourse frames and scripts
    Content-Security-Policy = "default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'sha256-UPkidoMErzWw1gW/eY4LhAi9ZkPch3PP31d6KQoJ6Yc=' https://mixxx.discourse.group/javascripts/embed.js *.discourse-cdn.com 'sha384-7J/UM6Vde6cXqst3EI86P36213Jz5rooW1EEUvweQ3F3gQOHkTuSKAX67ANmYljn' 'https://cdn.jsdelivr.net/npm/mermaid@11.2.1/dist/mermaid.min.js'; frame-src 'self' https://www.youtube-nocookie.com https://mixxx.discourse.group ; img-src 'self' https://i.ytimg.com ; connect-src 'self' https://mixxx.discourse.group https://*.discourse-cdn.com"


[[headers]]
  for = "/release_roadmap/"
  [headers.values]
    # Additionally allow Mermaid script
    Content-Security-Policy = "default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'sha384-7J/UM6Vde6cXqst3EI86P36213Jz5rooW1EEUvweQ3F3gQOHkTuSKAX67ANmYljn' 'nonce-VoYlObL+iS4p0ATVpB4f495PwA9FE4obmpj2VWc961Q='"
